{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * Matrix Block Use plugin for Craft CMS 3.x
 *
 * Matrix Block Use index.twig
 *
 * @author    Ye. Sokolov
 * @copyright Copyright (c) 2021 Ye. Sokolov
 * @link      http://site.url
 * @package   MatrixBlockUse
 * @since     0.0.1
 */
#}

{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% do view.registerAssetBundle("yesokolov\\matrixblockuse\\assetbundles\\matrixblockusecpsection\\MatrixBlockUseCPSectionAsset") %}

{% set docsUrl = "https://github.com/yesokolov/matrix-block-use/blob/master/README.md" %}

{% set title = "Matrix Block Use" %}

{% set pluginCpUrl = url('matrix-block-use') %}

{% set iconUrl = view.getAssetManager().getPublishedUrl('@yesokolov/matrixblockuse/assetbundles/matrixblockusecpsection/dist', true) ~ '/img/MatrixBlockUse-icon.svg' %}

{% set extraPageHeaderHtml %}
    <div class="buttons">
        <a href="{{ pluginCpUrl }}" class="btn submit add icon">{{ "Click Me!"|t('matrix-block-use') }}</a>
    </div>
{% endset %}

{% set content %}
     <style>
         table, td {
             border-collapse: separate;
             border: 1px solid #999;
         }
     </style>
    <table class="table" border>
        <thead>
            <tr>
                <td>Component</td>
                <td>Section</td>
                <td>Entries</td>
            </tr>
        </thead>
        <tbody>
            {% for component in blocks|keys %}
                <tr>
                    {% set blockLength = 0 %}
                    {% for section in blocks[component]|keys %}
                        {% for entry in blocks[component][section]  %}
                            {% set blockLength = blockLength + 1 %}
                        {% endfor %}
                    {% endfor %}
                    <td rowspan="{{ blockLength }}">{{ component }}</td>

                    {% for section in blocks[component]|keys %}
                        {% set second = loop.first ? false : true %}
                        {{ second == true ? '<tr>' }}
                            <td rowspan="{{ blocks[component][section]|length }}">{{ section }}</td>
                            {% for entry in blocks[component][section] %}
                                {% set loopEntry = loop.index == 1 ? false : true %}
                                {{ loopEntry == true ? '<tr>' }}
                                    <td>{{ entry }}</td>
                                {{ loopEntry == true ? '</tr>' }}
                            {% endfor %}
                        {{ second == true ? '</tr>' }}
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endset %}
